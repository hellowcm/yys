[General]
SyntaxVersion=2
BeginHotkey=122
BeginHotkeyMod=0
PauseHotkey=0
PauseHotkeyMod=0
StopHotkey=123
StopHotkeyMod=0
RunOnce=1
EnableWindow=
MacroID=9fc2bdfc-f2b5-4811-8eed-a7746390b430
Description=妖气封印辅助
Enable=1
AutoRun=0
[Repeat]
Type=0
Number=1
[SetupUI]
Type=1
QUI=Main
[Relative]
SetupOCXFile=
[Comment]

[Attachment]
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


[UIPackage]
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


[Script]
// 默认延时
StringDelay = 2000
Delay 5000
appL = 0
appT = 40
appR = 1024
appB = 768

Dim startTime
startTime = Now

Dim formerpage
// 当前战斗次数
btimes = 0
// 随机数生成
Function randnumber() 
    最小 = -10*0.9 
    最大 = 10*0.91 
    // 根据实际情况设置，最小不要低过1 最大可以是3~~~10 或者3~~~~100。
    Randomize
    randnumber = Round((最大 - 最小 + 1) * Rnd + 最小) 
End Function
Dim formertxt
// 屏幕显示提示
Function showTips(txt)
    //TracePrint txt
    Main.tips.Caption = txt 
    If formertxt = txt Then
    Else
        formertxt = txt
        logtext = txt
        Call savelog
    End If
End Function

Dim logtext
Sub savelog
    logtext = Time & "   " & logtext  & " | 已运行时间s=" & runtime
    Main.logtext.Text = Main.logtext.Text & logtext & vbCrLf
End Sub
// 随机点击屏幕
Sub randomclick()
    btop = 100
    bright = 100
    bleft = 200
    bbottom = 250
    Randomize
    x = Round((appR -bright - appL - bleft) * Rnd + appL + bleft)
    y = Round((appB - bbottom - appT  - btop) * Rnd + appT + btop)
    MoveTo x, y 
    Delay 1000
    LeftClick 1
End Sub
Sub OnScriptExit()'脚本停止事件
    btimes = 0
    Call showTips("app stop.")
End Sub

// Form events
Event Main.clearlog.Click
    Main.logtext.Text = ""
End Event


Sub findapp()
    // 句柄获取
    dim yys 
    // 找到程序位置
    Call showTips("finding app...")
    // 查找程序句柄
    yys = Plugin.Window.Find(0, "阴阳师-网易游戏")
    If yys <> 0 Then 
        //激活窗口
        Call Plugin.Window.Restore(yys)
        sRect = Plugin.Window.GetClientRect(yys)
        //下面这句用于分割字符串,将横坐标和纵坐标分成两个字符串   
        dim MyArray
        MyArray = Split(sRect, "|")   
        //下面这句将字符串转换成数值   
        appL = Clng(MyArray(0)): appT = Clng(MyArray(1))   
        appR = Clng(MyArray(2)): appB = Clng(MyArray(3))   
        Call showTips(yys & " |左" & appL & ",右 " & appR & ",上" & appT & ",下" & appB)
    Else
        Call showTips("阴阳师桌面版没有运行，请先运行游戏再启动程序")
        ExitScript 
    End If
    Delay StringDelay
End Sub

Call findapp()

// 觉醒入口
Dim jxbtn(1)
jxbtn(0) = 85 + appL
jxbtn(1) = appB - 50
// 准备按钮
Dim readybtn(1)
readybtn(0) = appR - 145
readybtn(1) = appB - 180
// pos
Dim anypos(1)
Dim closebtn(1)

// 打开组队界面
Sub openGroup()
    MoveTo jxbtn(0) + randnumber, jxbtn(1) + randnumber
    Delay StringDelay
    LeftClick 1
    // 选择材料入口
    Delay StringDelay
    MoveTo appL + 225+randnumber, 300 + appT+randnumber
    Delay StringDelay
    LeftClick 1
    Delay StringDelay

    // 找组队按钮
    MoveTo 570+appL+randnumber, 440+appT+randnumber
    Delay StringDelay
    LeftClick 1
End Sub

// 去妖气封印
Sub gotoyq()
    XY=Plugin.Color.FindMutiColor(appL,appT,appR,appB,"252A2D","-2|8|32383D,-6|9|25292D,0|14|202427,-5|18|383E43,4|18|2A2F33,15|18|202427,8|11|2B3135,13|8|2E3337,7|3|30363A,10|2|3F464C,12|0|282D31",1)
    MyArray = Split(XY, "|")
    X = CInt(MyArray(0)): Y = CInt(MyArray(1))
    If X > 0 And Y > 0 Then
        Call showTips("点击妖气封印")
        MoveTo X + randnumber, Y + randnumber
        Delay StringDelay
        LeftClick 1
    End If
End Sub

Rem appstart

// 判断运行时间
runtime = DateDiff("s", startTime, Now)

// 战斗次数
maxtimes = CInt(Main.maxtimes.Text)
If btimes > maxtimes Then
    Call showTips("达到最大战斗次数，脚本停止运行")
    ExitScript
End If

// 检测当前页
nowpage = -1
Do
    // 大地图界面
    XY=Plugin.Color.FindMutiColor(appL,appT,appR,appB,"178ACE","-3|12|8B3189,15|1|8E368D,22|2|A03CA0,32|2|1680C5,33|9|AAD3E1,39|25|B1D8E4,48|36|2769A1,49|40|9BBECD",1)
    MyArray = Split(XY, "|")
    X = CInt(MyArray(0)): Y = CInt(MyArray(1))
    If X > 0 And Y > 0 Then
        nowpage = 0
        Goto checkend
    End If

    XY=Plugin.Color.FindMutiColor(appL,appT,appR,appB,"E0F3F8","-2|9|DDF0F5,3|7|DBEEF3,1|14|E0F3F8,14|-2|DAECF1,11|-1|C5D7DD,8|0|A0B0B7,11|4|DBEDF2,7|7|E0F3F8,10|9|DFF2F7,16|15|E0F3F8",1)
    MyArray = Split(XY, "|")
    X = CInt(MyArray(0)): Y = CInt(MyArray(1))
    If X > 0 And Y > 0 Then
        //Call showTips("在妖气封印界面")
        nowpage = 10
        Goto checkend
    End If

    XY=Plugin.Color.FindMutiColor(appL,appT,appR,appB,"D6E8EE","-4|5|DDF0F5,-6|9|DFF2F7,2|6|DFF2F7,-2|11|DFF3F8,-5|16|E0F3F8,1|14|DCEFF4,-5|22|E0F3F8,7|5|DEF1F6,7|11|DCEFF4,7|21|E0F3F8,15|3|E0F3F8,15|11|E0F3F8,15|22|E0F3F8,18|22|E0F3F8",1)
    MyArray = Split(XY, "|")
    X = CInt(MyArray(0)): Y = CInt(MyArray(1))
    If X > 0 And Y > 0 Then
        //Call showTips("在组队界面")
        nowpage = 1
        Goto checkend
    End If

    XY=Plugin.Color.FindMutiColor(appL,appT,appR,appB,"D0F2FF","-5|10|D0F2FF,5|6|D0F2FF,0|12|D0F2FF,-4|19|D0F2FF,-4|28|D0F2FF,11|4|D0F2FF,11|18|D0F2FF,11|28|D0F2FF,22|28|D0F2FF,22|3|D0F2FF",1)
    MyArray = Split(XY, "|")
    X = CInt(MyArray(0)): Y = CInt(MyArray(1))
    If X > 0 And Y > 0 Then
        //进入战斗
        nowpage = 20
    End If

    FindColor appL,appT,appR,appB,"A1BBD4",intX,intY
    If intX> 0 And intY> 0 Then
        // 战斗准备
        nowpage = 21
        Goto checkend
    End If

    // battle end 
    XY=Plugin.Color.FindMutiColor(appL,appT,appR,appB,"31D3E1","5|9|081333,9|13|2CAFE0,6|19|3BB6E3,11|19|27B4E4",1)
    MyArray = Split(XY, "|")
    X = CInt(MyArray(0)): Y = CInt(MyArray(1))
    If X > 0 And Y > 0 Then
        //战斗结束
        Call showTips("战斗奖励结算")
        nowpage = 30
        anypos(0) = X : anypos(1) = Y
        Goto checkend
    End If

    // fail
    XY=Plugin.Color.FindMutiColor(appL,appT,appR,appB,"50424A","6|22|51424A,-11|42|65525B,20|42|5A4950,42|42|69555F,29|80|6D5861,-3|80|836A74",1)
    MyArray = Split(XY, "|")
    X = CInt(MyArray(0)): Y = CInt(MyArray(1))
    If X > 0 And Y > 0 Then
        //战斗结束
        Call showTips("战斗失败")
        nowpage = 30
        anypos(0) = X : anypos(1) = Y
        Goto checkend
    End If

    // other has close icon
    FindPic appL,appT,appR,appB, "Attachment:\close.bmp", 0.5, intX, intY
    If intX > 0 and intY > 0 Then 
        Call showTips("has close btn_" & intX & "," & intY) 
        closebtn(0) = intX + 10
        closebtn(1) = intY + 10
        //nowpage = 3
    End If

    Rem checkend
    Exit Do
Loop

Call showTips("nowpage=" & nowpage & " | btimes=" & btimes)

Select Case nowpage
    Case 0
        Call openGroup()
    Case 1
        Call gotoyq()
    Case 3
        MoveTo closebtn(0)+randnumber, closebtn(1)+randnumber
        Delay StringDelay
        LeftClick 1
    Case 10
        // 检测有的妖气封印
        // 点击刷新
        MoveTo appL+430+randnumber, appB-70+randnumber
        Delay 500
        LeftClick 1

        // check yaoqi
        For 3
            // 日和坊
            XY=Plugin.Color.FindMutiColor(appL,appT,appR,appB,"2D3236","0|4|262B2E,-3|11|222629,9|-1|25292D,8|7|272B2E,10|15|202427",1)
            MyArray = Split(XY, "|")
            X = CInt(MyArray(0)): Y = CInt(MyArray(1))
            If X > 0 And Y > 0 Then
                Call showTips("日和坊: " & X & "," & Y)
                MoveTo X + 450 + randnumber, Y + 20+randnumber
                Delay 300
                LeftClick 1
                Exit For
            End If
            Delay 500
        Next
    Case 21
        MoveTo readybtn(0)+randnumber, readybtn(1)+randnumber
        Delay 1000
        LeftClick 1
    Case 30
        MoveTo anypos(0) + randnumber, anypos(1)+randnumber
        Delay StringDelay
        LeftClick 1
        If formerpage <> 30 Then
            btimes = btimes + 1
        End If
End Select

Delay 1000

If formerpage <> nowpage Then
    formerpage = nowpage
End If

Goto appstart